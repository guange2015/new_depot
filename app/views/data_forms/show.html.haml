= render_crumbs
%p
  - unless @data_form.finished?
    = form_for @data_list do |d|
      - if @data_list.errors.any?
        #error_explanation
          %h2
            = "有#{@data_list.errors.count}个错误"
            \:
          %ul
            - @data_list.errors.full_messages.each do |msg|
              %li= msg
      - if flash[:notice]
        %p.error.high= flash[:notice]
      = d.label "品名==规格"
      ：
      = d.autocomplete_field  :firework, data_forms_autocomplete_firework_name_path, :id_element => '#data_list_firework_id',:update_elements => {:lastdata => "#depot_last_data"}
      = d.text_field :firework_id,:size=>3,:hidden=>true
      %span 库存:
      %span#depot_last_data.high 0
      = d.label @data_form.get_type+"量"
      ：
      \#{d.text_field :data_number,:size=>3}
      %span.require *填数字
      = d.hidden_field :s_type,:value => @data_form.s_type
      = d.hidden_field :data_form_id,:value => @data_form.id.to_s
      <input type="button" onclick="commit_data()" value="新增",html:{class:'btn btn-default'} />
  %hr/
  %table.table.table-bordered
    %tr
      %th 类型
      %th 品名
      %th 型号
      %th 日期
      %th 数量
      %th 库存
      %th 操作
    - @data_form.data_lists.order("created_at asc").each do |f|
      %tr
        %td= f.get_type
        %td= f.firework.name
        %td= f.firework.spec
        %td= format_date(f.created_at)
        %td= f.data_number
        %td= f.firework.lastdata
        %td= link_delete( data_list_path(f)+"?data_form_id="+@data_form.id.to_s, !@data_form.finished? )
  %p
    .btn-group
      = link_to_unless @data_form.finished?,"完成", finished_path(@data_form), class:'btn btn-default'
      = link_to "返回", data_forms_path,class: 'btn btn-default'
